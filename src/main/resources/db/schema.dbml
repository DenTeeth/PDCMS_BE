// Dental Clinic Management System - Database Schema
// Generated from PostgreSQL schema.sql
// For use with dbdiagram.io

// ========================================
// ENUMS
// ========================================

Enum account_status {
  ACTIVE
  INACTIVE
  SUSPENDED
  LOCKED
  PENDING_VERIFICATION
}

Enum appointment_action_type {
  CREATE
  DELAY
  RESCHEDULE_SOURCE
  RESCHEDULE_TARGET
  CANCEL
  STATUS_CHANGE
}

Enum appointment_participant_role_enum {
  ASSISTANT
  SECONDARY_DOCTOR
  OBSERVER
}

Enum appointment_reason_code {
  PREVIOUS_CASE_OVERRUN
  DOCTOR_UNAVAILABLE
  EQUIPMENT_FAILURE
  PATIENT_REQUEST
  OPERATIONAL_REDIRECT
  OTHER
}

Enum appointment_status_enum {
  SCHEDULED
  CHECKED_IN
  IN_PROGRESS
  COMPLETED
  CANCELLED
  CANCELLED_LATE
  NO_SHOW
}

Enum approval_status {
  DRAFT
  PENDING_REVIEW
  APPROVED
  REJECTED
}

Enum attachment_type_enum {
  XRAY
  PHOTO_BEFORE
  PHOTO_AFTER
  LAB_RESULT
  CONSENT_FORM
  OTHER
}

Enum balance_change_reason {
  ANNUAL_RESET
  APPROVED_REQUEST
  REJECTED_REQUEST
  CANCELLED_REQUEST
  MANUAL_ADJUSTMENT
}

Enum contact_history_action {
  CALL
  MESSAGE
  NOTE
}

Enum customer_contact_source {
  WEBSITE
  FACEBOOK
  ZALO
  WALK_IN
  REFERRAL
}

Enum customer_contact_status {
  NEW
  CONTACTED
  APPOINTMENT_SET
  NOT_INTERESTED
  CONVERTED
}

Enum day_of_week {
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
  SUNDAY
}

Enum employee_shifts_source {
  BATCH_JOB
  REGISTRATION_JOB
  OT_APPROVAL
  MANUAL_ENTRY
}

Enum employment_type {
  FULL_TIME
  PART_TIME_FIXED
  PART_TIME_FLEX
}

Enum gender {
  MALE
  FEMALE
  OTHER
}

Enum holiday_type {
  NATIONAL
  COMPANY
}

Enum image_type {
  XRAY
  PHOTO
  BEFORE_TREATMENT
  AFTER_TREATMENT
  SCAN
  OTHER
}

Enum invoice_payment_status {
  PENDING_PAYMENT
  PARTIAL_PAID
  PAID
  CANCELLED
}

Enum invoice_type {
  APPOINTMENT
  TREATMENT_PLAN
  SUPPLEMENTAL
}

Enum notification_entity_type {
  APPOINTMENT
  TREATMENT_PLAN
  PAYMENT
  SYSTEM
  TIME_OFF_REQUEST
  OVERTIME_REQUEST
  PART_TIME_REGISTRATION
}

Enum notification_type {
  APPOINTMENT_CREATED
  APPOINTMENT_UPDATED
  APPOINTMENT_CANCELLED
  APPOINTMENT_REMINDER
  APPOINTMENT_COMPLETED
  TREATMENT_PLAN_APPROVED
  TREATMENT_PLAN_UPDATED
  PAYMENT_RECEIVED
  SYSTEM_ANNOUNCEMENT
  REQUEST_TIME_OFF_PENDING
  REQUEST_OVERTIME_PENDING
  REQUEST_PART_TIME_PENDING
}

Enum payment_method {
  SEPAY
}

Enum payment_transaction_status {
  PENDING
  SUCCESS
  FAILED
  CANCELLED
}

Enum plan_item_status {
  READY_FOR_BOOKING
  SCHEDULED
  PENDING
  IN_PROGRESS
  COMPLETED
  WAITING_FOR_PREREQUISITE
  SKIPPED
}

Enum renewal_status {
  PENDING_ACTION
  CONFIRMED
  FINALIZED
  DECLINED
  EXPIRED
}

Enum request_status {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
}

Enum shift_status {
  SCHEDULED
  ON_LEAVE
  COMPLETED
  ABSENT
  CANCELLED
}

Enum tooth_condition_enum {
  HEALTHY
  CARIES_MILD
  CARIES_MODERATE
  CARIES_SEVERE
  FILLED
  CROWN
  MISSING
  IMPLANT
  ROOT_CANAL
  FRACTURED
  IMPACTED
}

Enum work_shift_category {
  NORMAL
  NIGHT
}

// ========================================
// CORE AUTHENTICATION & AUTHORIZATION
// ========================================

Table accounts {
  account_id integer [pk, increment]
  is_email_verified boolean
  must_change_password boolean
  created_at timestamp
  password_changed_at timestamp
  account_code varchar(20)
  role_id varchar(50) [not null, ref: > roles.role_id]
  username varchar(50) [not null, unique]
  email varchar(100) [not null, unique]
  password varchar(255) [not null]
  status varchar(255)
}

Table account_verification_tokens {
  token_id varchar(50) [pk]
  account_id integer [not null, ref: > accounts.account_id]
  created_at timestamp [not null]
  expires_at timestamp [not null]
  verified_at timestamp
  token varchar(100) [not null, unique]
}

Table password_reset_tokens {
  token_id varchar(50) [pk]
  account_id integer [not null, ref: > accounts.account_id]
  created_at timestamp [not null]
  expires_at timestamp [not null]
  used_at timestamp
  token varchar(100) [not null, unique]
}

Table refresh_tokens {
  id varchar(36) [pk]
  account_id integer [not null, ref: > accounts.account_id]
  is_active boolean [not null]
  created_at timestamp [not null]
  expires_at timestamp [not null]
  updated_at timestamp
  token_hash varchar(512) [not null, unique]
}

Table blacklisted_tokens {
  token_hash varchar(512) [pk]
  account_id integer [ref: > accounts.account_id]
  blacklisted_at timestamp [not null]
  expires_at timestamp [not null]
  reason varchar(50)
}

Table base_roles {
  base_role_id integer [pk, increment]
  is_active boolean
  created_at timestamp
  updated_at timestamp
  base_role_name varchar(50) [not null, unique]
  description text
}

Table roles {
  role_id varchar(50) [pk]
  base_role_id integer [not null, ref: > base_roles.base_role_id]
  is_active boolean
  requires_specialization boolean
  created_at timestamp
  role_name varchar(50) [not null]
  description text
}

Table permissions {
  permission_id varchar(50) [pk]
  display_order integer
  is_active boolean
  created_at timestamp
  module varchar(20) [not null]
  parent_permission_id varchar(50) [ref: > permissions.permission_id]
  permission_name varchar(100) [not null]
  description text
}

Table role_permissions {
  role_id varchar(50) [pk, ref: > roles.role_id]
  permission_id varchar(50) [pk, ref: > permissions.permission_id]
}

// ========================================
// EMPLOYEES & PATIENTS
// ========================================

Table employees {
  employee_id integer [pk, increment]
  account_id integer [not null, unique, ref: > accounts.account_id]
  date_of_birth date
  is_active boolean
  created_at timestamp
  phone varchar(15)
  employee_code varchar(20) [unique]
  first_name varchar(50) [not null]
  last_name varchar(50) [not null]
  address text
  employment_type varchar(255)
}

Table specializations {
  specialization_id integer [pk]
  is_active boolean
  created_at timestamp
  specialization_code varchar(20) [not null, unique]
  specialization_name varchar(100) [not null]
  description text
}

Table employee_specializations {
  employee_id integer [pk, ref: > employees.employee_id]
  specialization_id integer [pk, ref: > specializations.specialization_id]
}

Table patients {
  patient_id integer [pk, increment]
  account_id integer [unique, ref: > accounts.account_id]
  consecutive_no_shows integer [not null]
  date_of_birth date
  is_active boolean
  is_booking_blocked boolean [not null]
  blocked_at timestamp
  created_at timestamp
  updated_at timestamp
  gender varchar(10)
  emergency_contact_phone varchar(15)
  guardian_phone varchar(15)
  phone varchar(15)
  guardian_citizen_id varchar(20)
  patient_code varchar(20) [unique]
  booking_block_reason varchar(50)
  first_name varchar(50) [not null]
  guardian_relationship varchar(50)
  last_name varchar(50) [not null]
  blocked_by varchar(100)
  email varchar(100)
  emergency_contact_name varchar(100)
  emergency_contact_relationship varchar(100)
  guardian_name varchar(100)
  address text
  allergies text
  booking_block_notes text
  medical_history text
}

Table patient_unban_audit_logs {
  audit_id bigint [pk, increment]
  patient_id integer [not null, ref: > patients.patient_id]
  previous_no_show_count integer [not null]
  timestamp timestamp [not null]
  performed_by_role varchar(50) [not null]
  performed_by varchar(100) [not null]
  reason text [not null]
}

Table patient_tooth_status {
  tooth_status_id integer [pk, increment]
  patient_id integer [not null, ref: > patients.patient_id]
  recorded_at timestamp
  updated_at timestamp
  tooth_number varchar(10) [not null]
  notes text
  status varchar(255) [not null]
  
  indexes {
    (patient_id, tooth_number) [unique]
  }
}

Table patient_tooth_status_history {
  history_id integer [pk, increment]
  patient_id integer [not null, ref: > patients.patient_id]
  changed_by integer [not null, ref: > employees.employee_id]
  changed_at timestamp
  tooth_number varchar(10) [not null]
  new_status varchar(255) [not null]
  old_status varchar(255)
  reason text
}

// ========================================
// APPOINTMENTS & SCHEDULING
// ========================================

Table rooms {
  room_id varchar(50) [pk]
  is_active boolean
  created_at timestamp
  room_code varchar(20) [not null, unique]
  room_type varchar(50)
  room_name varchar(100) [not null]
}

Table appointments {
  appointment_id integer [pk, increment]
  created_by integer [ref: > employees.employee_id]
  employee_id integer [not null, ref: > employees.employee_id]
  expected_duration_minutes integer [not null]
  patient_id integer [not null, ref: > patients.patient_id]
  reschedule_count integer [not null]
  rescheduled_to_appointment_id integer [ref: > appointments.appointment_id]
  actual_end_time timestamp
  actual_start_time timestamp
  appointment_end_time timestamp [not null]
  appointment_start_time timestamp [not null]
  created_at timestamp
  updated_at timestamp
  appointment_code varchar(20) [not null, unique]
  room_id varchar(50) [not null, ref: > rooms.room_id]
  notes text
  status varchar(255) [not null]
}

Table appointment_participants {
  appointment_id integer [pk, ref: > appointments.appointment_id]
  employee_id integer [pk, ref: > employees.employee_id]
  participant_role varchar(255) [not null]
}

Table appointment_services {
  appointment_id integer [pk, ref: > appointments.appointment_id]
  service_id integer [pk, ref: > services.service_id]
}

Table appointment_audit_logs {
  log_id integer [pk, increment]
  appointment_id integer [not null, ref: > appointments.appointment_id]
  changed_by_employee_id integer [ref: > employees.employee_id]
  action_timestamp timestamp
  created_at timestamp
  new_start_time timestamp
  old_start_time timestamp
  new_value text
  notes text
  old_value text
  action_type appointment_action_type [not null]
  new_status appointment_status_enum
  old_status appointment_status_enum
  reason_code appointment_reason_code
}

// ========================================
// SERVICES & CATEGORIES
// ========================================

Table service_categories {
  category_id bigint [pk, increment]
  display_order integer [not null]
  is_active boolean [not null]
  created_at timestamp [not null]
  updated_at timestamp
  category_code varchar(50) [not null, unique]
  category_name varchar(255) [not null]
  description text
}

Table services {
  service_id integer [pk, increment]
  default_buffer_minutes integer [not null]
  default_duration_minutes integer [not null]
  display_order integer [not null]
  is_active boolean [not null]
  max_appointments_per_day integer
  minimum_preparation_days integer
  price decimal(15,2) [not null]
  recovery_days integer
  spacing_days integer
  specialization_id integer [ref: > specializations.specialization_id]
  category_id bigint [ref: > service_categories.category_id]
  created_at timestamp [not null]
  updated_at timestamp
  service_code varchar(50) [not null, unique]
  description text
  service_name varchar(255) [not null]
}

Table room_services {
  room_id varchar(255) [pk, ref: > rooms.room_id]
  service_id integer [pk, ref: > services.service_id]
  created_at timestamp [not null]
}

Table service_dependencies {
  dependency_id bigint [pk, increment]
  service_id bigint [not null, ref: > services.service_id]
  dependent_service_id bigint [not null, ref: > services.service_id]
  min_days_apart integer
  created_at timestamp [not null]
  rule_type varchar(30) [not null]
  receptionist_note text
}

// ========================================
// CLINICAL RECORDS
// ========================================

Table clinical_records {
  clinical_record_id integer [pk, increment]
  appointment_id integer [not null, unique, ref: > appointments.appointment_id]
  follow_up_date date
  created_at timestamp
  updated_at timestamp
  chief_complaint text
  diagnosis text
  examination_findings text
  treatment_notes text
  vital_signs jsonb
}

Table clinical_record_procedures {
  procedure_id integer [pk, increment]
  clinical_record_id integer [not null, ref: > clinical_records.clinical_record_id]
  storage_transaction_id integer [ref: > storage_transactions.transaction_id]
  created_at timestamp
  materials_deducted_at timestamp
  patient_plan_item_id bigint [ref: > patient_plan_items.item_id]
  service_id bigint [ref: > services.service_id]
  updated_at timestamp
  tooth_number varchar(10)
  materials_deducted_by varchar(100)
  notes text
  procedure_description text [not null]
}

Table procedure_material_usage {
  usage_id bigint [pk, increment]
  procedure_id integer [not null, ref: > clinical_record_procedures.procedure_id]
  item_master_id bigint [not null, ref: > item_masters.item_master_id]
  unit_id bigint [not null, ref: > item_units.unit_id]
  actual_quantity decimal(10,2) [not null]
  planned_quantity decimal(10,2) [not null]
  quantity decimal(10,2) [not null]
  recorded_at timestamp
  recorded_by varchar(100)
  variance_reason varchar(500)
  notes text
}

Table clinical_record_attachments {
  attachment_id integer [pk, increment]
  clinical_record_id integer [not null, ref: > clinical_records.clinical_record_id]
  uploaded_by integer [ref: > employees.employee_id]
  file_size bigint [not null]
  uploaded_at timestamp
  mime_type varchar(100) [not null]
  file_path varchar(500) [not null]
  description text
  file_name varchar(255) [not null]
  attachment_type attachment_type_enum [not null]
}

Table clinical_prescriptions {
  prescription_id integer [pk, increment]
  clinical_record_id integer [not null, ref: > clinical_records.clinical_record_id]
  created_at timestamp
  prescription_notes text
}

Table clinical_prescription_items {
  prescription_item_id integer [pk, increment]
  prescription_id integer [not null, ref: > clinical_prescriptions.prescription_id]
  quantity integer [not null]
  created_at timestamp
  item_master_id bigint [ref: > item_masters.item_master_id]
  dosage_instructions text
  item_name varchar(255) [not null]
}

// ========================================
// TREATMENT PLANS
// ========================================

Table treatment_plan_templates {
  template_id bigint [pk, increment]
  estimated_duration_days integer
  is_active boolean
  specialization_id integer [ref: > specializations.specialization_id]
  total_price decimal(12,2)
  created_at timestamp
  updated_at timestamp
  template_code varchar(50) [not null, unique]
  description text
  template_name varchar(255) [not null]
}

Table template_phases {
  phase_id bigint [pk, increment]
  template_id bigint [not null, ref: > treatment_plan_templates.template_id]
  estimated_duration_days integer
  phase_number integer [not null]
  created_at timestamp
  updated_at timestamp
  phase_name varchar(255) [not null]
  
  indexes {
    (template_id, phase_number) [unique]
  }
}

Table template_phase_services {
  phase_service_id bigint [pk, increment]
  phase_id bigint [not null, ref: > template_phases.phase_id]
  service_id bigint [not null, ref: > services.service_id]
  estimated_time_minutes integer
  quantity integer [not null]
  sequence_number integer [not null]
  created_at timestamp
  updated_at timestamp
  
  indexes {
    (phase_id, service_id) [unique]
  }
}

Table patient_treatment_plans {
  plan_id bigint [pk, increment]
  approved_by integer [ref: > employees.employee_id]
  created_by integer [ref: > employees.employee_id]
  discount_amount decimal(12,2)
  expected_end_date date
  final_cost decimal(12,2)
  installment_count integer
  installment_interval_days integer
  patient_id integer [not null, ref: > patients.patient_id]
  specialization_id integer [ref: > specializations.specialization_id]
  start_date date
  total_price decimal(12,2)
  approved_at timestamp
  created_at timestamp [not null]
  patient_consent_date timestamp
  template_id bigint [ref: > treatment_plan_templates.template_id]
  approval_status varchar(20) [not null]
  payment_type varchar(20)
  status varchar(20)
  plan_code varchar(50) [not null, unique]
  plan_name varchar(255) [not null]
  rejection_reason text
}

Table patient_plan_phases {
  patient_phase_id bigint [pk, increment]
  plan_id bigint [not null, ref: > patient_treatment_plans.plan_id]
  completion_date date
  estimated_duration_days integer
  phase_number integer [not null]
  start_date date
  created_at timestamp [not null]
  status varchar(20)
  phase_name varchar(255) [not null]
}

Table patient_plan_items {
  item_id bigint [pk, increment]
  assigned_doctor_id integer [ref: > employees.employee_id]
  estimated_time_minutes integer
  price decimal(10,2)
  price_updated_by integer [ref: > employees.employee_id]
  sequence_number integer [not null]
  service_id integer [not null, ref: > services.service_id]
  completed_at timestamp
  created_at timestamp [not null]
  phase_id bigint [not null, ref: > patient_plan_phases.patient_phase_id]
  price_updated_at timestamp
  status varchar(30) [not null]
  price_update_reason varchar(500)
  item_name varchar(255) [not null]
}

Table appointment_plan_items {
  appointment_id bigint [pk, ref: > appointments.appointment_id]
  item_id bigint [pk, ref: > patient_plan_items.item_id]
}

Table plan_audit_logs {
  log_id bigint [pk, increment]
  performed_by integer [not null, ref: > employees.employee_id]
  created_at timestamp [not null]
  plan_id bigint [not null, ref: > patient_treatment_plans.plan_id]
  new_approval_status varchar(20)
  old_approval_status varchar(20)
  action_type varchar(50) [not null]
  notes text
}

// ========================================
// INVOICES & PAYMENTS
// ========================================

Table invoices {
  invoice_id integer [pk, increment]
  appointment_id integer [ref: > appointments.appointment_id]
  created_by integer [not null, ref: > employees.employee_id]
  installment_number integer
  paid_amount decimal(15,2) [not null]
  patient_id integer [not null, ref: > patients.patient_id]
  phase_number integer
  remaining_debt decimal(15,2) [not null]
  total_amount decimal(15,2) [not null]
  treatment_plan_id integer [ref: > patient_treatment_plans.plan_id]
  created_at timestamp [not null]
  due_date timestamp
  updated_at timestamp
  invoice_type varchar(20) [not null]
  payment_status varchar(20) [not null]
  invoice_code varchar(30) [not null, unique]
  notes text
}

Table invoice_items {
  item_id integer [pk, increment]
  invoice_id integer [not null, ref: > invoices.invoice_id]
  quantity integer [not null]
  service_id integer [not null]
  subtotal decimal(15,2) [not null]
  unit_price decimal(15,2) [not null]
  service_code varchar(50)
  notes text
  service_name varchar(255) [not null]
}

Table payments {
  payment_id integer [pk, increment]
  amount decimal(15,2) [not null]
  created_by integer [not null, ref: > employees.employee_id]
  invoice_id integer [not null, ref: > invoices.invoice_id]
  created_at timestamp [not null]
  payment_date timestamp [not null]
  payment_method varchar(20) [not null]
  payment_code varchar(30) [not null, unique]
  reference_number varchar(100)
  notes text
}

Table payment_transactions {
  transaction_id integer [pk, increment]
  amount decimal(15,2) [not null]
  payment_id integer [not null, ref: > payments.payment_id]
  created_at timestamp [not null]
  updated_at timestamp
  status varchar(20) [not null]
  payment_link_id varchar(100)
  callback_data text
  error_message text
}

// ========================================
// WAREHOUSE & INVENTORY
// ========================================

Table item_categories {
  category_id bigint [pk, increment]
  is_active boolean [not null]
  created_at timestamp [not null]
  parent_category_id bigint [ref: > item_categories.category_id]
  updated_at timestamp
  category_code varchar(50) [not null, unique]
  category_name varchar(255) [not null]
  description text
}

Table item_masters {
  item_master_id bigint [pk, increment]
  cached_total_quantity integer
  current_market_price decimal(15,2)
  default_shelf_life_days integer
  is_active boolean [not null]
  is_prescription_required boolean [not null]
  is_tool boolean [not null]
  max_stock_level integer [not null]
  min_stock_level integer [not null]
  cached_last_import_date timestamp
  cached_last_updated timestamp
  category_id bigint [ref: > item_categories.category_id]
  created_at timestamp [not null]
  updated_at timestamp
  item_code varchar(50) [not null, unique]
  unit_of_measure varchar(50)
  description text
  item_name varchar(255) [not null]
  warehouse_type varchar(255) [not null]
}

Table item_units {
  unit_id bigint [pk, increment]
  conversion_rate integer [not null]
  display_order integer
  is_active boolean [not null]
  is_base_unit boolean [not null]
  is_default_export_unit boolean [not null]
  is_default_import_unit boolean [not null]
  created_at timestamp [not null]
  item_master_id bigint [not null, ref: > item_masters.item_master_id]
  updated_at timestamp
  unit_name varchar(50) [not null]
}

Table suppliers {
  supplier_id bigint [pk, increment]
  is_active boolean [not null]
  is_blacklisted boolean
  last_order_date date
  rating_score decimal(3,1)
  total_orders integer
  created_at timestamp [not null]
  updated_at timestamp
  phone_number varchar(20)
  supplier_code varchar(50) [not null, unique]
  email varchar(100)
  address text
  contact_person varchar(255)
  notes text
  supplier_name varchar(255) [not null]
  tier_level varchar(255) [not null]
}

Table supplier_items {
  supplier_item_id bigint [pk, increment]
  is_preferred boolean [not null]
  item_master_id bigint [not null, ref: > item_masters.item_master_id]
  last_purchase_date timestamp
  supplier_id bigint [not null, ref: > suppliers.supplier_id]
  supplier_item_code varchar(100)
  
  indexes {
    (supplier_id, item_master_id) [unique]
  }
}

Table item_batches {
  batch_id bigint [pk, increment]
  expiry_date date [not null]
  initial_quantity integer
  is_unpacked boolean
  quantity_on_hand integer [not null]
  created_at timestamp [not null]
  imported_at timestamp [not null]
  item_master_id bigint [not null, ref: > item_masters.item_master_id]
  parent_batch_id bigint [ref: > item_batches.batch_id]
  supplier_id bigint [ref: > suppliers.supplier_id]
  unpacked_at timestamp
  unpacked_by_transaction_id bigint
  updated_at timestamp
  bin_location varchar(50)
  lot_number varchar(100) [not null]
  
  indexes {
    (item_master_id, lot_number) [unique]
  }
}

Table item_price_history {
  history_id bigint [pk, increment]
  effective_date date [not null]
  new_import_price decimal(15,2)
  old_import_price decimal(15,2)
  item_master_id bigint [not null, ref: > item_masters.item_master_id]
  supplier_id bigint [not null, ref: > suppliers.supplier_id]
  notes text
}

Table service_consumables {
  link_id bigint [pk, increment]
  quantity_per_service decimal(10,2) [not null]
  item_master_id bigint [not null, ref: > item_masters.item_master_id]
  service_id bigint [not null, ref: > services.service_id]
  unit_id bigint [not null, ref: > item_units.unit_id]
  notes text
  
  indexes {
    (service_id, item_master_id) [unique]
  }
}

Table storage_transactions {
  transaction_id bigint [pk, increment]
  approved_by_id integer [ref: > employees.employee_id]
  cancelled_by_id integer [ref: > employees.employee_id]
  created_by integer [ref: > employees.employee_id]
  due_date date
  expected_delivery_date date
  paid_amount decimal(15,2)
  rejected_by_id integer [ref: > employees.employee_id]
  related_appointment_id integer [ref: > appointments.appointment_id]
  remaining_debt decimal(15,2)
  total_value decimal(15,2)
  approved_at timestamp
  cancelled_at timestamp
  created_at timestamp [not null]
  rejected_at timestamp
  supplier_id bigint [ref: > suppliers.supplier_id]
  transaction_date timestamp [not null]
  approval_status varchar(20)
  export_type varchar(20)
  payment_status varchar(20)
  status varchar(20)
  transaction_code varchar(50) [not null, unique]
  invoice_number varchar(100) [unique]
  reference_code varchar(100)
  department_name varchar(200)
  requested_by varchar(200)
  cancellation_reason text
  notes text
  rejection_reason text
  transaction_type varchar(255) [not null]
}

Table storage_transaction_items {
  transaction_item_id bigint [pk, increment]
  price decimal(15,2)
  quantity_change integer [not null]
  total_line_value decimal(15,2)
  batch_id bigint [not null, ref: > item_batches.batch_id]
  transaction_id bigint [not null, ref: > storage_transactions.transaction_id]
  unit_id bigint [ref: > item_units.unit_id]
  item_code varchar(50)
  notes text
}

Table warehouse_audit_logs {
  log_id bigint [pk, increment]
  performed_by integer [ref: > employees.employee_id]
  batch_id bigint [ref: > item_batches.batch_id]
  created_at timestamp [not null]
  item_master_id bigint [ref: > item_masters.item_master_id]
  transaction_id bigint [ref: > storage_transactions.transaction_id]
  action_type varchar(255) [not null]
  new_value text
  old_value text
  reason text
}

// ========================================
// WORK SHIFTS & TIME OFF
// ========================================

Table work_shifts {
  work_shift_id varchar(30) [pk]
  end_time time [not null]
  is_active boolean [not null]
  start_time time [not null]
  category varchar(20) [not null]
  shift_name varchar(100) [not null]
}

Table employee_shifts {
  employee_shift_id varchar(20) [pk]
  created_by integer [ref: > employees.employee_id]
  employee_id integer [not null, ref: > employees.employee_id]
  is_overtime boolean [not null]
  work_date date [not null]
  created_at timestamp [not null]
  source_registration_id bigint
  updated_at timestamp
  source varchar(20) [not null]
  source_off_request_id varchar(20)
  source_ot_request_id varchar(20)
  status varchar(20) [not null]
  work_shift_id varchar(30) [not null, ref: > work_shifts.work_shift_id]
  notes text
  
  indexes {
    (employee_id, work_date, work_shift_id) [unique]
  }
}

Table fixed_shift_registrations {
  registration_id integer [pk, increment]
  effective_from date [not null]
  effective_to date
  employee_id integer [not null, ref: > employees.employee_id]
  is_active boolean [not null]
  created_at timestamp [not null]
  updated_at timestamp
  work_shift_id varchar(30) [not null, ref: > work_shifts.work_shift_id]
}

Table fixed_registration_days {
  registration_id integer [pk, ref: > fixed_shift_registrations.registration_id]
  day_of_week varchar(10) [pk]
}

Table part_time_slots {
  slot_id bigint [pk, increment]
  effective_from date [not null]
  effective_to date [not null]
  is_active boolean [not null]
  quota integer [not null]
  created_at timestamp [not null]
  updated_at timestamp
  work_shift_id varchar(30) [not null, ref: > work_shifts.work_shift_id]
  day_of_week varchar(255) [not null]
}

Table part_time_registrations {
  registration_id integer [pk, increment]
  effective_from date [not null]
  effective_to date [not null]
  employee_id integer [not null, ref: > employees.employee_id]
  is_active boolean [not null]
  processed_by integer [ref: > employees.employee_id]
  created_at timestamp [not null]
  part_time_slot_id bigint [not null, ref: > part_time_slots.slot_id]
  processed_at timestamp
  updated_at timestamp
  version bigint [not null]
  status varchar(20) [not null]
  reason text
}

Table part_time_registration_dates {
  registration_id integer [not null, ref: > part_time_registrations.registration_id]
  registered_date date
}

Table employee_shift_registrations {
  registration_id varchar(20) [pk]
  effective_from date [not null]
  effective_to date
  employee_id integer [not null, ref: > employees.employee_id]
  is_active boolean
  part_time_slot_id bigint [not null, ref: > part_time_slots.slot_id]
}

Table shift_renewal_requests {
  renewal_id varchar(20) [pk]
  employee_id integer [not null, ref: > employees.employee_id]
  expiring_registration_id integer [not null, ref: > fixed_shift_registrations.registration_id]
  confirmed_at timestamp
  created_at timestamp [not null]
  expires_at timestamp [not null]
  updated_at timestamp
  status varchar(20) [not null]
  decline_reason text
}

Table time_off_types {
  type_id varchar(50) [pk]
  default_days_per_year double
  is_active boolean [not null]
  is_paid boolean [not null]
  requires_approval boolean [not null]
  requires_balance boolean [not null]
  type_code varchar(50) [not null, unique]
  type_name varchar(100) [not null]
  description text
}

Table time_off_requests {
  request_id varchar(50) [pk]
  approved_by integer [ref: > employees.employee_id]
  employee_id integer [not null, ref: > employees.employee_id]
  end_date date [not null]
  requested_by integer [not null, ref: > employees.employee_id]
  start_date date [not null]
  approved_at timestamp
  requested_at timestamp [not null]
  status varchar(20) [not null]
  time_off_type_id varchar(50) [not null, ref: > time_off_types.type_id]
  work_shift_id varchar(50)
  cancellation_reason text
  reason text
  rejected_reason text
}

Table overtime_requests {
  request_id varchar(12) [pk]
  approved_by integer [ref: > employees.employee_id]
  employee_id integer [not null, ref: > employees.employee_id]
  requested_by integer [not null, ref: > employees.employee_id]
  work_date date [not null]
  approved_at timestamp
  created_at timestamp [not null]
  status varchar(20) [not null]
  work_shift_id varchar(30) [not null, ref: > work_shifts.work_shift_id]
  cancellation_reason text
  reason text [not null]
  rejected_reason text
  
  indexes {
    (employee_id, work_date, work_shift_id) [unique]
  }
}

Table employee_leave_balances {
  balance_id bigint [pk, increment]
  cycle_year integer [not null]
  days_taken double [not null]
  employee_id integer [not null, ref: > employees.employee_id]
  total_days_allowed double [not null]
  updated_at timestamp
  time_off_type_id varchar(50) [not null, ref: > time_off_types.type_id]
  notes text
  
  indexes {
    (employee_id, time_off_type_id, cycle_year) [unique]
  }
}

Table leave_balance_history {
  history_id bigint [pk, increment]
  change_amount double [not null]
  changed_by integer [not null, ref: > employees.employee_id]
  balance_id bigint [not null, ref: > employee_leave_balances.balance_id]
  created_at timestamp [not null]
  reason varchar(50) [not null]
  notes text
}

Table holiday_definitions {
  definition_id varchar(20) [pk]
  created_at timestamp [not null]
  updated_at timestamp
  holiday_type varchar(20) [not null]
  holiday_name varchar(100) [not null, unique]
  description varchar(500)
}

Table holiday_dates {
  holiday_date date [pk]
  definition_id varchar(20) [pk, ref: > holiday_definitions.definition_id]
  created_at timestamp [not null]
  updated_at timestamp
  description varchar(500)
}

// ========================================
// NOTIFICATIONS & MESSAGING
// ========================================

Table notifications {
  notification_id bigint [pk, increment]
  is_read boolean [not null]
  user_id integer [not null, ref: > accounts.account_id]
  created_at timestamp [not null]
  read_at timestamp
  related_entity_type varchar(50)
  type varchar(50) [not null]
  message text
  related_entity_id varchar(255)
  title varchar(255) [not null]
}

Table chatbot_knowledge {
  knowledge_id varchar(50) [pk]
  is_active boolean
  keywords text [not null]
  response text [not null]
}

// ========================================
// CUSTOMER CONTACT & CRM
// ========================================

Table customer_contacts {
  contact_id varchar(20) [pk]
  assigned_to integer [ref: > employees.employee_id]
  converted_patient_id integer [ref: > patients.patient_id]
  created_at timestamp
  updated_at timestamp
  phone varchar(15) [not null]
  source varchar(20)
  status varchar(20)
  email varchar(100)
  full_name varchar(100) [not null]
  service_interested varchar(100)
  message text
  notes text
}

Table contact_history {
  history_id varchar(20) [pk]
  employee_id integer [ref: > employees.employee_id]
  created_at timestamp
  action varchar(20) [not null]
  contact_id varchar(20) [not null, ref: > customer_contacts.contact_id]
  content text [not null]
}

// ========================================
// PATIENT IMAGES & DOCUMENTATION
// ========================================

Table patient_images {
  image_id bigint [pk, increment]
  captured_date date
  clinical_record_id integer [ref: > clinical_records.clinical_record_id]
  patient_id integer [not null, ref: > patients.patient_id]
  uploaded_by integer [ref: > employees.employee_id]
  created_at timestamp [not null]
  updated_at timestamp [not null]
  image_type varchar(50) [not null]
  cloudinary_public_id varchar(255) [not null]
  description text
  image_url text [not null]
}

Table patient_image_comments {
  comment_id bigint [pk, increment]
  created_by integer [not null, ref: > employees.employee_id]
  is_deleted boolean [not null]
  created_at timestamp [not null]
  image_id bigint [not null, ref: > patient_images.image_id]
  updated_at timestamp [not null]
  comment_text text [not null]
}

// ========================================
// REFERENCE DATA
// ========================================

Table vital_signs_reference {
  reference_id integer [pk, increment]
  age_max integer
  age_min integer [not null]
  effective_date date [not null]
  high_threshold decimal(10,2)
  is_active boolean [not null]
  low_threshold decimal(10,2)
  normal_max decimal(10,2)
  normal_min decimal(10,2)
  created_at timestamp [not null]
  updated_at timestamp
  unit varchar(20) [not null]
  vital_type varchar(50) [not null]
  description text
}
